{% extends "base.html" %}
{% block title %}Detalhes do Pedido Recebido{% endblock %}
{% block content %}
<div class="max-w-4xl mx-auto bg-white p-6 rounded-2xl shadow-md space-y-6">
	<h2 class="text-2xl font-bold text-gray-800">Detalhes do Pedido Recebido</h2>

	{% for solicitacao in solicitacao %}
		<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 text-sm text-gray-700">
			<div>
				<span class="font-semibold">Nome do funcionário:</span>
				<span id="nome-usuario" class="block">{{ solicitacao.nome_usuario }}</span>
			</div>
			<div>
				<span class="font-semibold">Nome da solicitação:</span>
				<span id="nome-solicitacao" class="block">{{ solicitacao.nome_solicitacao }}</span>
			</div>
			<div>
				<span class="font-semibold">Data Solicitação:</span>
				<span id="data" class="block">{{ solicitacao.data_solicitacao }}</span>
			</div>
			<div>
				<span class="font-semibold">Data recebimento:</span>
				<span id="data-recebido" class="block">{{ solicitacao.data_recebido }}</span>
			</div>
			<div>
				<span class="font-semibold">Setor:</span>
				<span id="setor" class="block">{{ solicitacao.nome_setor }}</span>
			</div>
			<div>
				<span class="font-semibold">Status:</span>
				<span id="status" class="block">{{ solicitacao.status_solicitacao }}</span>
			</div>
			<div class="md:col-span-2">
				<span class="font-semibold">Observação:</span>
				<span id="observacao" class="block">{{ solicitacao.observacao_recebido }}</span>
			</div>
			<div>
				<span class="font-semibold">Valor Frete:</span>
				<span id="valor-frete" class="block">R$ {{ solicitacao.frete_recebido }}</span>
			</div>
			<div>
				<span class="font-semibold">Valor Total:</span>
				<span id="valor-total" class="block">R$ {{ solicitacao.total_recebido }}</span>
			</div>
		</div>
	{% endfor %}

	<div>
		<h3 class="text-xl font-semibold text-gray-800 mb-2">Lista de Produtos</h3>
		<div class="overflow-x-auto">
			<table class="min-w-full bg-white border border-gray-300 text-sm">
				<thead class="bg-gray-100 text-gray-700 uppercase">
					<tr>
						<th class="px-4 py-2 border-b">Produto</th>
						<th class="px-4 py-2 border-b">Unidade</th>
						<th class="px-4 py-2 border-b">Quantidade</th>
						<th class="px-4 py-2 border-b">Valor Unitário (R$)</th>
						<th class="px-4 py-2 border-b">Valor Total (R$)</th>
					</tr>
				</thead>
				<tbody id="lista-produtos" class="text-gray-800">
					{% for produtos in produtos %}
						<tr class="hover:bg-gray-50 transition">
							<td class="px-4 py-2 border-b">{{ produtos['nome_produto'] }}</td>
							<td class="px-4 py-2 border-b">{{ produtos['unidade_produto'] }}</td>
							<td class="px-4 py-2 border-b">{{ produtos['quantidade_produto'] }}</td>
							<td class="px-4 py-2 border-b">R$ {{ produtos['valor_produto'] }}</td>
							<td class="px-4 py-2 border-b">R$ {{ produtos['valor_total'] }}</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>

	{% if session.nivel == 'administrador' %}
		{% for solicitacao in solicitacao %}
			<form id="requestForm" action="/editarStatusSolicitacao/{{ solicitacao.id_solicitacao }}" method="post" class="space-y-4">
		{% endfor %}
			<div class="flex flex-col gap-4 sm:flex-row sm:gap-2 w-full">
				<label for="statusPedido" class="block text-sm font-medium text-gray-700 sm:hidden">
					Editar Status do pedido:
				</label>

				<select id="statusPedido" name="status" required disabled
					class="flex-1 py-2 rounded border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm">
					<option value="Recebido">Recebido</option>
					<option value="Cancelado">Cancelado</option>
				</select>

				{% for solicitacao in solicitacao %}
					<button type="submit"
						class="w-full sm:w-1/3 bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600 disabled:opacity-50 transition whitespace-nowrap"
						{% if solicitacao.status_solicitacao == 'Recebido' %}disabled{% endif %}>
						Mudar Status
					</button>
				{% endfor %}
			</div>
		</form>
	{% endif %}
</div>


{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='js/detalhesSolicitacao.js') }}"></script>
{% endblock %}
