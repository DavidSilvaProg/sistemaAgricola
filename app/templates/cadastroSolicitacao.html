{% extends "base.html" %}
{% block title %}Cadastrar de solicitaÃ§Ã£o{% endblock %}
{% block content %}
<div class="max-w-3xl mx-auto p-4 bg-white rounded-lg shadow">
	<h2 class="text-2xl font-bold mb-4 text-gray-800">SolicitaÃ§Ã£o de Compra</h2>
	<div id="mensagem-erro" class="hidden bg-red-100 text-red-700 px-4 py-2 rounded mb-4 text-sm"></div>
	<form id="requestForm" action="cadastrarSolicitacao" method="post" class="space-y-4">

		<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
			<div>
				<label for="requester" class="block text-sm font-medium text-gray-700 mb-1">DescriÃ§Ã£o:</label>
				<input type="text" id="requester" name="nome" required
					class="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 ">
			</div>

			<div>
				<label for="setor" class="block text-sm font-medium text-gray-700 mb-1">Setor:</label>
				<select id="setor" name="setor"
					class="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500">
					<option value="0"></option>
					{% for setor in setores %}
						<option value="{{ setor.id_setor }}">{{ setor.nome_setor }}</option>
					{% endfor %}
				</select>
			</div>
		</div>

		<!-- SeleÃ§Ã£o de produto cadastrado -->
		<div>
			<h2 class="text-lg font-semibold text-gray-700 border-b pb-1 mb-2">ðŸ›’ Itens</h2>
			<label for="produto-input" class="block text-sm font-medium text-gray-700 mb-1">Selecionar Produto Cadastrado:</label>
			<div class="relative">
			<!-- Input com Ã­cone de lupa -->
			<div class="flex items-center bg-white border border-gray-300 rounded px-3">
				<i class="fas fa-search text-gray-400 mr-2"></i>
				<input
					type="text"
					id="produto-input"
					class="w-full py-2 text-sm text-gray-700 focus:outline-none"
					placeholder="Digite o nome do produto"
					autocomplete="off"
				/>
			</div>

			<!-- Autocomplete fixado com scroll -->
			<div
				id="autocomplete-container"
				class="absolute z-10 mt-1 w-full bg-white border rounded shadow hidden"
				style="max-height: 240px; overflow-y: auto; -webkit-overflow-scrolling: touch; overscroll-behavior: contain;"
			>
				<ul id="autocomplete-list" class="text-sm"></ul>
			</div>
		</div>
		</div>

		<!-- Produtos adicionados -->
		<div class="overflow-x-auto shadow rounded">
			<table class="min-w-[500px] text-sm text-gray-700 mt-4">
				<thead>
					<tr>
						<th class="px-3 py-2 border-b text-left">Produto</th>
						<th class="px-3 py-2 border-b text-left">Unidade</th>
						<th class="px-3 py-2 border-b text-left">Quantidade</th>
						<th class="px-3 py-2 border-b text-left">AÃ§Ãµes</th>
					</tr>
				</thead>
				<tbody id="inputsContainer">
					<!-- Linhas inseridas via JavaScript -->
				</tbody>
			</table>
		</div>

		<!-- BotÃ£o para produto nÃ£o cadastrado -->
		<div class="flex justify-center pt-4">
			<button
				type="button"
				onclick="adicionarProdutoAvulso()"
				class="bg-gray-100 text-gray-700 font-medium py-2 px-12 rounded hover:bg-gray-200 transition flex items-center gap-1"
			>
				<span>âž•</span> Produto nÃ£o cadastrado
			</button>
		</div>

		<!-- Prioridade -->
		<div>
			<label for="priority" class="block text-sm font-medium text-gray-700 mb-1">NÃ­vel de Prioridade:</label>
			<select id="priority" name="prioridade" required
				class="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
				<option value="Baixa">Baixa</option>
				<option value="MÃ©dia">MÃ©dia</option>
				<option value="Alta">Alta</option>
			</select>
		</div>

		<!-- BotÃ£o de envio -->
		<div class="pt-2">
			<button type="submit"
				class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded transition duration-300">
				âœ” Enviar
			</button>
		</div>
	</form>
</div>
{% endblock %}

{% block scripts %}
<script>
	window.produtos = [
		{% for produto in produtos %}
			{ nome: "{{ produto.nome_produto }}", id: "{{ produto.id_produto }}", unidade: "{{ produto.unidade_medida_produto }}" },
		{% endfor %}
	];
</script>
<script src="{{ url_for('static', filename='js/cadastroSolicitacao.js') }}"></script>
{% endblock %}
